\RequirePackage{appendix}
\RequirePackage{caption}
\RequirePackage{emptypage}
\RequirePackage{enumitem}
\RequirePackage{fancyhdr}
\RequirePackage{geometry}
\RequirePackage{graphicx}
\RequirePackage[hidelinks]{hyperref}
\RequirePackage[numbers,sectionbib,sort&compress]{natbib}
\RequirePackage{setspace}
\RequirePackage{titlesec}
\RequirePackage{tocloft}
\RequirePackage{xepersian}
\RequirePackage[bottom,flushmargin,hang,perpage]{footmisc}

\SepMark{-}
\urlstyle{same}

\AtBeginDocument{
    \renewcommand{\refname}{منابع}
    \renewcommand{\bibname}{\refname\vspace{\baselineskip}}
    \renewcommand{\listfigurename}{فهرست شکل‌ها}
    \renewcommand{\listtablename}{فهرست جدول‌ها}
}

%% تنظیم فاصله ی حاشیه صفحات
\geometry{paperheight=235mm,paperwidth=165mm,margin=20mm,right=25mm,marginparsep=0pt,headsep=5pt,asymmetric,includefoot}

%% تنضیمات مربوط به فونت
\settextfont[Scale=1]{B Nazanin}
\setlatintextfont[Scale=0.83]{Times New Roman}
\DeclareMathSizes{12}{10}{7}{6}
\DeclareMathSizes{10.95}{9}{7}{6}
\DeclareMathSizes{10}{8}{7}{6}
\setlength{\footnotesep}{0pt}

%% تنظیم پاراگراف بندی ها
\setlength{\parindent}{0pt}
\setlength{\parskip}{0pt}
\onehalfspacing

%% صفحه خالی
\newcommand{\blankpage}{
    \clearpage
    \shipout\null
    \thispagestyle{empty}
    \clearpage
}

%% صفحه بسم الله
\newcommand{\bismillah}{
    \clearpage
    \thispagestyle{empty}
    \vspace*{\fill}
    \begin{center}
        \includegraphics[width=0.8\textwidth]{assets/bismillah.jpg}
    \end{center}
    \vspace*{\fill}
}

%% سایز عنوان فهرست ها
\renewcommand{\cfttoctitlefont}{\hfil\bfseries}
\renewcommand{\cftaftertoctitle}{\vspace{\baselineskip}}
\setlength{\cftaftertoctitleskip}{0pt}
\setlength{\cftbeforetoctitleskip}{-1.55em}
\addtocontents{toc}{\textbf{عنوان}\hfill\textbf{صفحه}\par}

\renewcommand{\cftlottitlefont}{\hfil\bfseries}
\renewcommand{\cftafterlottitle}{\vspace{\baselineskip}}
\setlength{\cftafterlottitleskip}{0pt}
\setlength{\cftbeforelottitleskip}{-1.55em}
\addtocontents{lot}{\textbf{عنوان}\hfill\textbf{صفحه}\vspace{0.5\baselineskip}\par}

\renewcommand{\cftloftitlefont}{\hfil\bfseries}
\renewcommand{\cftafterloftitle}{\vspace{\baselineskip}}
\setlength{\cftafterloftitleskip}{0pt}
\setlength{\cftbeforeloftitleskip}{-1.55em}
\addtocontents{lof}{\textbf{عنوان}\hfill\textbf{صفحه}\vspace{0.5\baselineskip}\par}

%% دستورات اضافه کردن کلمه فصل به ابتدای شماره فصل در فهرست
\let\original@chapter\@chapter
\def\@chapter[#1]#2{
    \if@mainmatter
        \refstepcounter{chapter}
        \addcontentsline{toc}{chapter}{\chaptername~\tartibi{chapter}:~#1}
    \else
        \addcontentsline{toc}{chapter}{#1}
    \fi
    \chaptermark{#1}
    \if@twocolumn
        \@topnewpage[\@makechapterhead{#2}]
    \else
        \@makechapterhead{#2}
        \@afterheading
    \fi
}

%% استفاده از خط فاصله به جای نقطه در شماره گذاری سکشن ها
\renewcommand{\cftsecaftersnum}{\@SepMark}
\renewcommand{\cftsubsecaftersnum}{\@SepMark}
\renewcommand{\cftsubsubsecaftersnum}{\@SepMark}
\renewcommand{\cftfigaftersnum}{\@SepMark}
\renewcommand{\cfttabaftersnum}{\@SepMark}

%% افزودن کلمه شکل به اول موارد موجود در لیست تصاویر و جداول
\renewcommand{\@tocrmarg}{1.55em}

\renewcommand{\cfttabpresnum}{\tablename~}
\setlength{\cfttabindent}{0pt}
\addtolength{\cfttabnumwidth}{2.2em}

\renewcommand{\cftfigpresnum}{\figurename~}
\setlength{\cftfigindent}{0pt}
\addtolength{\cftfignumwidth}{2em}

%% نمایش خط فاصله در کپشن ها و لیست ها
\setlist{left=0pt,nosep}
\DeclareCaptionLabelSeparator{dash}{\@SepMark~}
\captionsetup{font=footnotesize,labelsep=dash}

%% تنظیمات نقطه چین
\renewcommand{\dotfill}{\leavevmode\cleaders\hbox to 2pt{\hss.\hss}\hfill\kern0pt}
\renewcommand{\cftdotsep}{\cftdot}
\renewcommand{\cftchapdotsep}{\cftdot}

%% وسط چین شماره گذاری فصل و نحوه نمایش آن
\titleformat{\chapter}[display]{\fontsize{16pt}{19pt}\selectfont\bfseries\centering}{\chaptername~\tartibi{chapter}}{24pt}{\thispagestyle{empty}}
\titlespacing*{\chapter}{0pt}{90pt}{2\baselineskip}

%% تنظیم فونت سکشن ها
\titleformat{\section}{\normalsize\bfseries}{\thesection\@SepMark~}{0pt}{}
\titlespacing*{\section}{0pt}{\baselineskip}{0pt}
\titleformat{\subsection}{\normalsize\bfseries}{\thesubsection\@SepMark~}{0pt}{}
\titlespacing*{\subsection}{0pt}{\baselineskip}{0pt}

%% تنظیمات هدر و فوتر
\fancyhf{}
\fancyfoot[C]{\thepage}
\fancyhead[R]{\textbf{\persiantitle}}
\setlength{\headheight}{16pt}
\addtolength{\topmargin}{-2pt}
\renewcommand{\chaptermark}[1]{\markboth{\chaptername~\tartibi{chapter}:~#1}{}}

%% تنظیمات پیوست
\renewcommand{\appendixtocname}{پیوست‌ها}
\newcommand{\app}[1]{\protect\section[\hspace{1.5em}#1]{#1}}
\AtBeginEnvironment{appendices}{\renewcommand{\thesection}{پیوست~\arabic{section}}}

%% لیست نشانه های اختصاری
\newcommand{\gloss}[2]{{#1}~\dotfill~{#2}\\}

%% تنظیم فاصله خطوط منابع
\let\originalthebibliography\thebibliography
\renewcommand{\thebibliography}[1]{
    \originalthebibliography{#1}
    \setlength{\parskip}{0pt}
    \setlength{\itemsep}{0pt plus 0.3ex}
}

%% تنضیم فاصله معادلات ریاضی
\AtBeginDocument{
    \setlength{\abovedisplayskip}{5pt}
    \setlength{\belowdisplayskip}{5pt}
    \setlength{\abovedisplayshortskip}{5pt}
    \setlength{\belowdisplayshortskip}{5pt}
}

%%نشان دادن تصاویر در بالای صفحه خالی
\setlength{\@fptop}{0pt}

%% کامندهای مربوط به اطلاعات پایان نامه
\newcommand{\name}[2]{\newcommand{\persianname}{#1}\newcommand{\latinname}{#2}}
\newcommand{\studentnumber}[1]{\newcommand{\persianstudentnumber}{#1}\newcommand{\latinstudentnumber}{#1}}

\newcommand{\university}[2]{\newcommand{\persianuniversity}{#1}\newcommand{\latinuniversity}{#2}}
\newcommand{\department}[2]{\newcommand{\persiandepartment}{#1}\newcommand{\latindepartment}{#2}}
\newcommand{\field}[2]{\newcommand{\persianfield}{#1}\newcommand{\latinfield}{#2}}
\newcommand{\degree}[2]{\newcommand{\persiandegree}{#1}\newcommand{\latindegree}{#2}}

\newcommand{\thesistitle}[2]{\newcommand{\persiantitle}{#1}\newcommand{\latintitle}{#2}}
\newcommand{\thesisdate}[2]{\newcommand{\persiandate}{#1}\newcommand{\latindate}{#2}}
\newcommand{\thesisgrade}[2]{\newcommand{\persiangrade}{#1}\newcommand{\latingrade}{#2}}
\newcommand{\thesistype}[2]{\newcommand{\persiantype}{#1}\newcommand{\latintype}{#2}}
\newcommand{\defensedate}[2]{\newcommand{\persiandefensedate}{#1}\newcommand{\latindefensedate}{#2}}

\newcommand{\supervisor}[3]{\newcommand{\persiansupervisor}{#1}\newcommand{\latinsupervisor}{#2}\newcommand{\latinsupervisorabbr}{#3}}
\newcommand{\supervisortitle}[2]{\newcommand{\persiansupervisortitle}{#1}\newcommand{\latinsupervisortitle}{#2}}
\newcommand{\supervisordepartment}[2]{\newcommand{\persiansupervisordepartment}{#1}\newcommand{\latinsupervisordepartment}{#2}}

\newcommand{\advisor}[2]{\newcommand{\persianadvisor}{#1}\newcommand{\latinadvisor}{#2}}
\newcommand{\advisortitle}[2]{\newcommand{\persianadvisortitle}{#1}\newcommand{\latinadvisortitle}{#2}}
\newcommand{\advisordepartment}[2]{\newcommand{\persianadvisordepartment}{#1}\newcommand{\latinadvisordepartment}{#2}}

\newcommand{\referee}[2]{\newcommand{\persianreferee}{#1}\newcommand{\latinreferee}{#2}}
\newcommand{\refereetitle}[2]{\newcommand{\persianrefereetitle}{#1}\newcommand{\latinrefereetitle}{#2}}
\newcommand{\refereedepartment}[2]{\newcommand{\persianrefereedepartment}{#1}\newcommand{\latinrefereedepartment}{#2}}

\newcommand{\externalreferee}[2]{\newcommand{\persianexternalreferee}{#1}\newcommand{\latinexternalreferee}{#2}}
\newcommand{\externalrefereetitle}[2]{\newcommand{\persianexternalrefereetitle}{#1}\newcommand{\latinexternalrefereetitle}{#2}}
\newcommand{\externalrefereedepartment}[2]{\newcommand{\persianexternalrefereedepartment}{#1}\newcommand{\latinexternalrefereedepartment}{#2}}
\newcommand{\externalrefereeuniversity}[2]{\newcommand{\persianexternalrefereeuniversity}{#1}\newcommand{\latinexternalrefereeuniversity}{#2}}

%% جلد فارسی و انگلیسی
\newcommand{\frontcover}{
    \AddToHookNext{shipout/background}{
        \put (0,-\paperheight){
            \includegraphics[width=\paperwidth,height=\paperheight,trim=0 0 102mm 0]{assets/cover.jpg}
        }
    }
    \blankpage
}
\newcommand{\backcover}{
    \AddToHookNext{shipout/background}{
        \put (0,-\paperheight){
            \includegraphics[width=\paperwidth,height=\paperheight,trim=115mm 0 0 0]{assets/cover.jpg}
        }
    }
    \blankpage
}
